<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>When is semi-infinite semi-infinite? · LightPropagation.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">LightPropagation.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../install/">Installation</a></li><li><a class="tocitem" href="../getting-started/">Getting Started</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../inversefitting/">Inverse Fitting</a></li><li class="is-active"><a class="tocitem" href>When is semi-infinite semi-infinite?</a><ul class="internal"><li><a class="tocitem" href="#Forward-Models"><span>Forward Models</span></a></li><li><a class="tocitem" href="#Inverse-Problem"><span>Inverse Problem</span></a></li></ul></li></ul></li><li><span class="tocitem">Forward Models</span><ul><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">Diffusion Approximation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../DA_slab_semiinfgeom/">Slab</a></li><li><a class="tocitem" href="../Nlayer_cyl/">N-layer Cylinder</a></li><li><a class="tocitem" href="../DA_DCS/">DCS</a></li></ul></li></ul></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>When is semi-infinite semi-infinite?</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>When is semi-infinite semi-infinite?</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/heltonmc/LightPropagation.jl/blob/master/docs/src/whensemiinf.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="*When-is-semi-infinite-semi-infinite?*"><a class="docs-heading-anchor" href="#*When-is-semi-infinite-semi-infinite?*"><em>When is semi-infinite semi-infinite?</em></a><a id="*When-is-semi-infinite-semi-infinite?*-1"></a><a class="docs-heading-anchor-permalink" href="#*When-is-semi-infinite-semi-infinite?*" title="Permalink"></a></h1><h3 id="Learning-outcomes:"><a class="docs-heading-anchor" href="#Learning-outcomes:">Learning outcomes:</a><a id="Learning-outcomes:-1"></a><a class="docs-heading-anchor-permalink" href="#Learning-outcomes:" title="Permalink"></a></h3><ul><li>Simulate the time-domain fluence under the diffusion approximation for <strong>semi-finite, slab, and parralelepiped</strong> geometries</li><li>Utilize the non-linear curve fitting functions to extract optical properties from simulated experimental data</li><li>Gain physical intuition of approximations and how to apply them</li></ul><div class="admonition is-info"><header class="admonition-header">Disclaimer</header><div class="admonition-body"><p>The following is not a recommendation on when to apply certain approximations as that would depend on experimental setup and application. Please use this as an introduction to the software.</p></div></div><h5 id="Loading-LightPropagation.jl"><a class="docs-heading-anchor" href="#Loading-LightPropagation.jl">Loading LightPropagation.jl</a><a id="Loading-LightPropagation.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-LightPropagation.jl" title="Permalink"></a></h5><p>Let&#39;s begin by loading the package into the current environment. This can be done as below or as shown on the main page.</p><pre><code class="language-julia hljs">using LightPropagation</code></pre><h2 id="Forward-Models"><a class="docs-heading-anchor" href="#Forward-Models">Forward Models</a><a id="Forward-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Forward-Models" title="Permalink"></a></h2><p>The functions we are using to simulate the TPSF for the semi-infinite, slab, and parallelpiped geometries are:</p><ul><li><strong>fluence_DA_semiinf_TD</strong></li><li><strong>fluence_DA_slab_TD</strong></li><li><strong>fluence_DA_paralpip_TD</strong></li></ul><h3 id="Semi-infinite"><a class="docs-heading-anchor" href="#Semi-infinite">Semi-infinite</a><a id="Semi-infinite-1"></a><a class="docs-heading-anchor-permalink" href="#Semi-infinite" title="Permalink"></a></h3><p>Let&#39;s simulate the fluence for a semi-infinite medium under the following conditions in the time-domain:</p><ul><li>t = 0.01:0.01:5 (ns)</li><li>μa = 0.1 – absorption coefficient (1/cm)</li><li>μsp = 10.0 – reduced scattering coefficient (1/cm)</li><li>ρ = 1.0 – source-detector separation (cm)</li><li>n_ext = 1.0 – index of refraction of external medium</li><li>n_med = 1.0 – index of refraction of medium</li></ul><pre><code class="language-julia hljs">t = 0.01:0.01:5
semiinf = fluence_DA_semiinf_TD(t, 1.0, 0.1, 10.0, n_ext = 1.0, n_med = 1.0)</code></pre><h3 id="Slab"><a class="docs-heading-anchor" href="#Slab">Slab</a><a id="Slab-1"></a><a class="docs-heading-anchor-permalink" href="#Slab" title="Permalink"></a></h3><p>Let&#39;s simulate the time-domain fluence for a slab (bounded in the z-direction) for two thicknesses (2cm and 8cm) with the same optical properties and SDS as simulated for the semi-infinite medium. The inputs are the same as the semi-infinite geometry with an additional input for the slab thickness.</p><pre><code class="language-julia hljs">slab_2cm = fluence_DA_slab_TD(t, 1.0, 0.1, 10.0, s = 2.0) # n_ext and n_med default to 1.0, z defaults to 0.0
slab_8cm = fluence_DA_slab_TD(t, 1.0, 0.1, 10.0, s = 8.0)</code></pre><h3 id="Parallelepiped"><a class="docs-heading-anchor" href="#Parallelepiped">Parallelepiped</a><a id="Parallelepiped-1"></a><a class="docs-heading-anchor-permalink" href="#Parallelepiped" title="Permalink"></a></h3><p>The parralelepiped geometry is bounded in the x, y, and z direction. Check the difference in input arguments by typing <code>? fluence_DA_paralpip_TD</code> into the REPL. You can see that the inputs are slightly different than the slab and semi-infinite geometry. Instead of listing the SDS we need to specify the location of the source and detector in x, y, z coordinates. Here, rd is the x, y, z location of the source on the top surface, and rs is the location of the detector on the top source. These are measured from the corner. Let&#39;s have two cubes one with L = 8cm and L = 4cm with the source located in the center so that rs = [4.0, 4.0] and [2.0, 2.0] respectively. We want the detector to be 1cm from the source to match SDS in previous examples. Below they are defined as rd = [3.0, 4.0, 0.0] and [1.0, 2.0, 0.0].        </p><pre><code class="language-julia hljs">paralpip_8cm = fluence_DA_paralpip_TD(t, 0.1, 10.0, rd = [3.0, 4.0, 0.0], rs = [4.0,4.0], L = [8.0,8.0,8.0])
paralpip_4cm = fluence_DA_paralpip_TD(t, 0.1, 10.0, rd = [1.0, 2.0, 0.0], rs = [2.0, 2.0], L = [4.0,4.0,4.0])</code></pre><h4 id="Compare-all-three-geometries"><a class="docs-heading-anchor" href="#Compare-all-three-geometries">Compare all three geometries</a><a id="Compare-all-three-geometries-1"></a><a class="docs-heading-anchor-permalink" href="#Compare-all-three-geometries" title="Permalink"></a></h4><p>Now let&#39;s compare and visualize all 5 of the curves we have simulated as shown below:</p><pre><code class="language-julia hljs">using Plots
plot(t, semiinf, yscale=:log10, lw = 10, ylabel = &quot;fluence (1/cm²)&quot;, xlabel = &quot;time (ns)&quot;, label = &quot;semiinf&quot;)
plot!(t, slab_2cm, lw = 2, label = &quot;lab_2cm&quot;)
plot!(t, slab_8cm, lw = 4, label = &quot;slab_8cm&quot;, c=&quot;black&quot;)
plot!(t, paralpip_8cm, lw = 2, label = &quot;paralpip_8cm&quot;, alpha = 0.9)
plot!(t, paralpip_4cm, lw = 2, label = &quot;paralpip_4cm&quot;, alpha = 0.9)</code></pre><p><img src="../assets/modelcomparisonTD.png" alt="modelcomparison"/></p><p>Great. Now change the input parameters for each curve (optical properties and SDS) to investigate different domains. Here, for this set of optical properties and SDS the  semi-infinite approximation matches exactly the slab solution when the slab thickness is 8cm (for t &lt; 5ns), though it would be a poor approximation for thin samples (2cm). The parallelepiped geometry also matches the semi-infinite geometry when its sides are greater than 8cm, though there are some differences at longer time scales. In practice, experimental systems would not have enough dynamic range to fit over such large changes in intensity.</p><h4 id="Key-Takeaways"><a class="docs-heading-anchor" href="#Key-Takeaways">Key Takeaways</a><a id="Key-Takeaways-1"></a><a class="docs-heading-anchor-permalink" href="#Key-Takeaways" title="Permalink"></a></h4><ul><li>Good agreement at the earliest times (&lt;1ns) where the boundary effects are minimized. </li><li>For confined geometries, we see there are significant differences compared to the semi-infinite approximations.</li><li>If the boundaries are significantly away from the source the semi-infinite approximation appears to be a good approximation.</li><li>If the underlying media is a parralelepiped, would a semi-infinite geometry under or overestimate the optical properties? Hint: Changes in absorption mainly affect the later times, while scattering dominates early arrival times.</li></ul><h2 id="Inverse-Problem"><a class="docs-heading-anchor" href="#Inverse-Problem">Inverse Problem</a><a id="Inverse-Problem-1"></a><a class="docs-heading-anchor-permalink" href="#Inverse-Problem" title="Permalink"></a></h2><p>Now that we have visually observed the differences between the three geometries, let&#39;s investigate and try to quantify the error when using the models in the inverse problem to extract optical properties.</p><p>The first thing we must do is simulate some experimental data to fit. In practice, samples are not infinite so let&#39;s use the parralelepiped geometry as the ground &#39;truth&#39; and let&#39;s fit all three models to that curve. You can add noise (follows a poisson distribution) if you would like, but let&#39;s assume no noise for now.</p><pre><code class="language-julia hljs">ydata = fluence_DA_paralpip_TD(t, 0.1, 10.0, rd = [0.5, 1.5, 0.0], rs = [1.5, 1.5], L = [3.0, 3.0, 3.0])</code></pre><h5 id="Setup-Inverse-problem"><a class="docs-heading-anchor" href="#Setup-Inverse-problem">Setup Inverse problem</a><a id="Setup-Inverse-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-Inverse-problem" title="Permalink"></a></h5><p>The first thing we must do is set up the input data and models. See the Inverse Fit tutorial for more information!</p><pre><code class="language-julia hljs">julia&gt; t_arr = 0.02:0.01:4.0
julia&gt; ydata = log10.(fluence_DA_paralpip_TD(t_arr, 0.1, 10.0, rd = [0.5, 1.5, 0.0], rs = [1.5, 1.5], L = [3.0, 3.0, 3.0]))
julia&gt; ub = [1.0, 50.0] # upper bound for [μa, μsp]
julia&gt; lb = [0.01, 3.0] # lower bound for [μa, μsp]
julia&gt; p0 = [0.12, 18.2] # some initial guess for our algorithm

julia&gt; model_semiinf(t, β) = log10.(fluence_DA_semiinf_TD(t, ρ, β[1], β[2]))
julia&gt; model_slab(t, β) = log10.(fluence_DA_slab_TD(t, ρ, β[1], β[2], s = 3.0))
julia&gt; model_paral(t, β) = log10.(fluence_DA_paralpip_TD(t, β[1], β[2], rd = [0.5, 1.5, 0.0], rs = [1.5, 1.5], L = [3.0, 3.0, 3.0]))

julia&gt; fit_semiinf = curve_fit(model_semiinf, t_arr, ydata, p0, lower=lb, upper=ub)
julia&gt; fit_slab = curve_fit(model_slab, t_arr, ydata, p0, lower=lb, upper=ub)
julia&gt; fit_paral = curve_fit(model_paral, t_arr, ydata, p0, lower=lb, upper=ub)</code></pre><pre><code class="language-julia hljs">scatter(t_arr, ydata, ms = 8, label = &quot;ydata&quot;, c=&quot;black&quot;, ylabel = &quot;fluence (1/cm²)&quot;, xlabel = &quot;time (ns)&quot;)
plot!(t_arr, model_paral(t_arr, fit_paral.param), lw = 3, alpha = 1, label = &quot;paralpip model&quot;, c=&quot;blue&quot;)
plot!(t_arr, model_semiinf(t_arr, fit_semiinf.param), lw = 3, alpha = 1,label = &quot;semiinf model&quot;, c=&quot;red&quot;)
plot!(t_arr, model_slab(t_arr, fit_slab.param),lw = 3, alpha = 1, label = &quot;slab model&quot;, c=&quot;orange&quot;)</code></pre><p><img src="../assets/fitcomparisonTD.png" alt="fitcomparison"/></p><p>To check the extracted optical properties we can call the param field of our fit result like:</p><pre><code class="language-julia hljs">julia&gt; fit_paral.param
2-element Vector{Float64}:
  0.1000000000000203
 10.000000000002833

julia&gt; fit_slab.param
2-element Vector{Float64}:
 0.13805160496964075
 8.432187697059568

julia&gt; fit_semiinf.param
2-element Vector{Float64}:
  0.14792469689680052
 10.222734757205624</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../inversefitting/">« Inverse Fitting</a><a class="docs-footer-nextpage" href="../DA_slab_semiinfgeom/">Slab »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.16 on <span class="colophon-date" title="Saturday 23 April 2022 00:44">Saturday 23 April 2022</span>. Using Julia version 1.5.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
