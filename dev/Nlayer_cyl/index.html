<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>N-layer Cylinder · LightPropagation.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">LightPropagation.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../install/">Installation</a></li><li><a class="tocitem" href="../getting-started/">Getting Started</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../inversefitting/">Inverse Fitting</a></li><li><a class="tocitem" href="../whensemiinf/">When is semi-infinite semi-infinite?</a></li><li><a class="tocitem" href="../Nlay_tutorial/">N-layer Cylinder Examples</a></li></ul></li><li><span class="tocitem">Forward Models</span><ul><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox" checked/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">Diffusion Approximation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../DA_slab_semiinfgeom/">Slab</a></li><li class="is-active"><a class="tocitem" href>N-layer Cylinder</a></li><li><a class="tocitem" href="../DA_DCS/">DCS</a></li></ul></li></ul></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Forward Models</a></li><li><a class="is-disabled">Diffusion Approximation</a></li><li class="is-active"><a href>N-layer Cylinder</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>N-layer Cylinder</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/heltonmc/LightPropagation.jl/blob/main/docs/src/Nlayer_cyl.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Light-Diffusion-in-a-N-layered-turbid-cylinder"><a class="docs-heading-anchor" href="#Light-Diffusion-in-a-N-layered-turbid-cylinder">Light Diffusion in a N-layered turbid cylinder</a><a id="Light-Diffusion-in-a-N-layered-turbid-cylinder-1"></a><a class="docs-heading-anchor-permalink" href="#Light-Diffusion-in-a-N-layered-turbid-cylinder" title="Permalink"></a></h1><p>The salient features and their implementation of <a href="https://www.osapublishing.org/oe/fulltext.cfm?uri=oe-18-9-9266&amp;id=198273">Liemert and Kienle&#39;s</a><sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> solution to the diffusion equation for the N-layered finite cylinder are discussed. </p><h4 id="Helpful-Background-Reading:"><a class="docs-heading-anchor" href="#Helpful-Background-Reading:">Helpful Background Reading:</a><a id="Helpful-Background-Reading:-1"></a><a class="docs-heading-anchor-permalink" href="#Helpful-Background-Reading:" title="Permalink"></a></h4><ul><li>Light diffusion in a turbed cylinder. I. Homogoeneous case<sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup></li><li>Light diffusion in a turbed cylinder. II. Layered case<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup></li><li>Noninvasive determination of the optical properties of two-layered turbid media<sup class="footnote-reference"><a id="citeref-3" href="#footnote-3">[3]</a></sup></li><li>Light diffusion in N-layered turbid media: steady-state domain<sup class="footnote-reference"><a id="citeref-4" href="#footnote-4">[4]</a></sup></li><li>Light diffusion in N-layered turbid media: frequency and time domains<sup class="footnote-reference"><a id="citeref-5" href="#footnote-5">[5]</a></sup></li></ul><h4 id="Nomenclature:"><a class="docs-heading-anchor" href="#Nomenclature:">Nomenclature:</a><a id="Nomenclature:-1"></a><a class="docs-heading-anchor-permalink" href="#Nomenclature:" title="Permalink"></a></h4><p>We follow the solution for a point beam incident onto the center top of the first layer of N-layered cylinders with radii <span>$a$</span>. In cylindrical cooridnates <span>$\vec{r}=(\rho, \phi, z)$</span> the source position can be defined as <span>$\vec{r_0}=(0,0,z_0)$</span> where <span>$z_0$</span> is the assumed position of an isotropic source at a distance <span>$z_0 = \frac{1}{\mu_{s1}&#39;}$</span>. We ignore the absorption term but if desired can be redefined in the <code>diffusionparams</code> function. The thickness, refractive index, reduced scattering and absorption coefficients of layer k are denoted by <span>$l_k, n_k, \mu_{s_k}&#39;, \mu_{a_k}$</span>, respectively. The extrapolated boundary condition is used with the extrapolation length <span>$z_{b_k} = 2 A_k D_k$</span> where <span>$A_k$</span> reflection factor calculated from the angle-averaged probability for reflection at a boundary between layer <span>$k$</span> and the surrounding medium. We calculate <span>$A_k$</span> from the polonomial approximation listed in <a href="https://www.osapublishing.org/ao/abstract.cfm?uri=ao-36-19-4587">Contini 1997</a> but can be calculated in anyway by altering the <code>get_afac</code> function. Finally, the diffusion coefficient in layer k is <span>$D_k = 1/(3\mu_s&#39;)$</span>.</p><h4 id="Solution"><a class="docs-heading-anchor" href="#Solution">Solution</a><a id="Solution-1"></a><a class="docs-heading-anchor-permalink" href="#Solution" title="Permalink"></a></h4><p>The solution for the fluence in the first layer <span>$\Phi_1(\vec{r}, \omega)$</span> for a point source incident onto the center of the cylinder top can then be described by Equation 22 in Ref 1. <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup></p><p class="math-container">\[\Phi_1(\vec{r}) = \frac{1}{\pi a&#39;^2} \sum_{n=1}^{\infty} G_1(s_n, z) J_0(s_n \rho)J_1^{-2}(a&#39; s_n)\]</p><p>Where <span>$a&#39; = a + z_{b_k}$</span>, <span>$\rho$</span> is the source-detector separation, and <span>$J_m$</span> is the Bessel function of the first kind and order <span>$m$</span>. More interestingly, <span>$s_n$</span> are the roots of <span>$J_m$</span> satisfying <span>$J_m(a&#39; s_n) = 0,\qquad n = 1, 2, ...,$</span>. For an incident source on the center top, the summation over all orders of <span>$J_m$</span> is no longer needed so we only need to consider <span>$m=0$</span>. <span>$s_n$</span> then becomes the roots to Bessel function of the first kind and zero order. It should be noted that both <span>$J_0$</span> and <span>$J_1$</span> appear in the solution but this is because the general solution is in the form of <span>$J_m$</span> and <span>$J_{m+1}$</span>. For those familiar with the trickier case presented in <sup class="footnote-reference"><a id="citeref-3" href="#footnote-3">[3]</a></sup> and then extended in <sup class="footnote-reference"><a id="citeref-4" href="#footnote-4">[4]</a></sup> and <sup class="footnote-reference"><a id="citeref-5" href="#footnote-5">[5]</a></sup> this is main contribution to the accuracy, stability, and speed of the solutions. For those unfamilar, the decisive point is the numerically correct and efficient 2-D inverse Fourier transform of <span>$\Phi(z, s)$</span> must be calculated to obtain the fluence in real space <span>$\Phi(\vec{r})$</span> (directly taking language from Liemert here). I would say this is most easily implemented by taking advantage of rotational symmetry and using the 1-D inverse Hankel Transform. In contrast, the nodes of the integral are not fixed like in the cylindrical case presented here, but is solved by adaptive Gauss integration. If the nodes were consistent, they could be precomputed and used for each case but the amount of nodes and their location depend on the forward parameters in the model. All this to say, precalculating the roots and storing them is highly efficient and significantly more accurate and stable. The roots are divided by <span>$a&#39;$</span> for each new condition.</p><h4 id="Green&#39;s-function"><a class="docs-heading-anchor" href="#Green&#39;s-function">Green&#39;s function</a><a id="Green&#39;s-function-1"></a><a class="docs-heading-anchor-permalink" href="#Green&#39;s-function" title="Permalink"></a></h4><p>Finally, the Green&#39;s function in the first layer <span>$G_1(s_n, z)$</span> is:</p><p class="math-container">\[G_1(s_n, z) = \frac{e^{-\alpha_1 |z - z_0|} - e^{-\alpha_1 (z + z_0 + 2z_{b_1})}}{2D_1 \alpha_1} + \frac{\sinh{[\alpha_1(z_0 + z_{b_1})]} \sinh{[\alpha_1(z + z_{b_1})]}}{D_1\alpha_1 e^{\alpha_1(l_1 + z_{b_1})}} \\[5pt]
\times \frac{D_1\alpha_1n_1^2\beta_3 - D_2\alpha_2n_2^2\gamma_3}{D_1\alpha_1n_1^2\beta_3\cosh{\alpha_1(l_1 + z_{b_1})} + D_2\alpha_2n_2^2\gamma_3\sinh{\alpha_1(l_1 + z_{b_1})}}\]</p><p>Where <span>$\alpha_k$</span> has the form in the steady-state:</p><p class="math-container">\[\alpha_k = \sqrt{s_n^2 + \frac{\mu_{a_k}}{D}}\]</p><p>Whereas a complex term is added in the Frequency Domain:</p><p class="math-container">\[\alpha_k = \sqrt{s_n^2 + \frac{\mu_{a_k}}{D} + \frac{i\omega}{Dc}}\]</p><p>As you can notice the first term of <span>$G_1(s_n, z)$</span> contains exponentially decaying functions which is great as you can see that <span>$\alpha$</span> has to be summed for very large numbers. Generally <span>$z, z_b, z_0$</span> are around 0.1 so this is easy to handle computationally. On the other hand, terms like <span>$\sinh{\alpha l}$</span> and <span>$\cosh{\alpha l}$</span> go to infinity very quickly. It is much better to define (though messier) the Green&#39;s function in terms of exponetials using <span>$\sinh{x} = (e^x - e^{-x})/2$</span> and <span>$\cosh{x} = (e^x + e^{-x})/2$</span>. After some algebraic manipulation we can then define <span>$G_1(s_n, z)$</span> as:</p><p class="math-container">\[G_1(s_n, z) = \frac{e^{-\alpha_1 |z - z_0|} - e^{-\alpha_1 (z + z_0 + 2z_{b_1})}}{2D_1 \alpha_1} + \frac{e^{\alpha_1(z_0 + z - 2l_1)}[1 - e^{-2\alpha_1(z_0 + z_{b_1})}]}{2D_1\alpha_1} \\[5pt]
\times \frac{D_1\alpha_1n_1^2\beta_3 - D_2\alpha_2n_2^2\gamma_3}{D_1\alpha_1n_1^2\beta_3[1 + e^{-2\alpha_1(l_1 + z_{b_1})}] + D_2\alpha_2n_2^2\gamma_3[1 - e^{-2\alpha_1(l_1 + z_{b_1})}]}\]</p><p>Great. So now we have expressed the Green&#39;s function in terms of exponentially decaying functions instead of dividing by exponentially growing functions so we are confident that we won&#39;t get overflow errors as <span>$\alpha$</span> goes to infinity. We are now ready to discuss the last pesky thing which are the <span>$\gamma_3$</span> and <span>$\beta_3$</span> factors. These are generally obtained from recurrence relations in <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> by equation 17 and 18. As presented they also contain exponentially growing functions. Where before we only had <span>$\sinh{\alpha_1 l_1}$</span> now we have exponential functions of all the layers. This is especially challenging if we consider the bottom layer to be large. In general the same procedure we used prior should be used but we can&#39;t explicitly write them in terms of decaying functions because these factors actually do exponentially increase. What we can do is take advantage of the way they present in <span>$G_1(s_n, z)$</span> which is <span>$(\beta_3 - \gamma_3)/(\beta_3 + \gamma_3)$</span>. We need to find a common exponentially growing factor that presents in both coefficients that we can then cancel.</p><p>After we factor a common term out we can then define the coefficients for an N-layered cylinder as :</p><p><span>$N = 2$</span>:</p><p class="math-container">\[\beta_3 = 1 - e^{-2 \alpha_2 (l_2 + z_{b_2})} \\[5pt]
\gamma_3 = 1 + e^{-2 \alpha_2 (l_2 + z_{b_2})}\]</p><p><span>$N = 3$</span>:</p><p class="math-container">\[\beta_3 = D_2 \alpha_2 n_2^2 (1 + e^{-2\alpha_2 l_2})(1 - e^{-2 \alpha_3 (l_3 + z_{b_2})}) + D_3 \alpha_3 n_3^2 (1 - e^{-2\alpha_2 l_2})(1 + e^{-2 \alpha_3 (l_3 + z_{b_2})}) \\[5pt]
\gamma_3 = D_2 \alpha_2 n_2^2 (1 - e^{-2\alpha_2 l_2})(1 - e^{-2 \alpha_3 (l_3 + z_{b_2})}) + D_3 \alpha_3 n_3^2 (1 + e^{-2\alpha_2 l_2})(1 + e^{-2 \alpha_3 (l_3 + z_{b_2})})\]</p><p><span>$N = 4$</span>:</p><p class="math-container">\[\beta_4 = D_3 \alpha_3 n_3^2 (1 + e^{-2\alpha_3 l_3}) (1 - e^{-2\alpha_4 (l_4 + z_{b_2}}) + D_4 \alpha_4 n_4^2 (1 - e^{-2\alpha_3 l_3}) (1 + e^{-2\alpha_4 (l_4 + z_{b_2}}) \\[5pt]
\gamma_4 = D_3 \alpha_3 n_3^2 (1 - e^{-2\alpha_3 l_3}) (1 - e^{-2\alpha_4 (l_4 + z_{b_2}}) + D_4 \alpha_4 n_4^2 (1 + e^{-2\alpha_3 l_3}) (1 + e^{-2\alpha_4 (l_4 + z_{b_2}}) \\\]</p><p class="math-container">\[\beta_3 = D_2 \alpha_2 n_2^2 \beta_4 (1 + e^{-2\alpha_2 l_2}) + D_3 \alpha_3 n_3^2 \gamma_4 (1 - e^{-2\alpha_2 l_2}) \\[5pt]
\gamma_3 = D_2 \alpha_2 n_2^2 \beta_4 (1 - e^{-2\alpha_2 l_2}) + D_3 \alpha_3 n_3^2 \gamma_4 (1 + e^{-2\alpha_2 l_2})\]</p><p><span>$N &gt; 4$</span>: Use start values</p><p class="math-container">\[\beta_N = D_{N-1} \alpha_{N-1} n_{n-1}^2 (1 + e^{-2\alpha_{N-1}l_{N-1}})(1 - e^{-2\alpha_{N-1}(l_{N-1} + z_{b_2})}) \\[5pt]
 + D_{N} \alpha_{N} n_{n}^2 (1 - e^{-2\alpha_{N-1}l_{N-1}})(1 + e^{-2\alpha_{N}(l_{N} + z_{b_2})}) \\[10pt]
\gamma_N = D_{N-1} \alpha_{N-1} n_{n-1}^2 (1 - e^{-2\alpha_{N-1}l_{N-1}})(1 - e^{-2\alpha_{N-1}(l_{N-1} + z_{b_2})}) \\[5pt]
 + D_{N} \alpha_{N} n_{n}^2 (1 + e^{-2\alpha_{N-1}l_{N-1}})(1 + e^{-2\alpha_{N}(l_{N} + z_{b_2})})\]</p><p>With downward recurrence relations: </p><p class="math-container">\[\beta_{k - 1} = D_{k - 2} \alpha_{k - 2} n_{k - 2}^2 (1 + e^{-2\alpha_{k - 2}l_{k - 2}}) \beta_k + D_{k - 1} \alpha_{k - 1} n_{k - 1}^2 (1 - e^{-2\alpha_{k - 2}l_{k - 2}}) \gamma_k \\[5pt]
\gamma_{k - 1} = D_{k - 2} \alpha_{k - 2} n_{k - 2}^2 (1 - e^{-2\alpha_{k - 2}l_{k - 2}}) \beta_k + D_{k - 1} \alpha_{k - 1} n_{k - 1}^2 (1 + e^{-2\alpha_{k - 2}l_{k - 2}}) \gamma_k\]</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>Liemert, André, and Alwin Kienle. &quot;Light diffusion in a turbid cylinder. II. Layered case.&quot; Optics Express 18.9 (2010): 9266-9279.</li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>Liemert, André, and Alwin Kienle. &quot;Light diffusion in a turbid cylinder. I. Homogeneous case.&quot; Optics Express 18.9 (2010): 9456-9473.</li><li class="footnote" id="footnote-3"><a class="tag is-link" href="#citeref-3">3</a>Kienle, Alwin, et al. &quot;Noninvasive determination of the optical properties of two-layered turbid media.&quot; Applied optics 37.4 (1998): 779-791.</li><li class="footnote" id="footnote-4"><a class="tag is-link" href="#citeref-4">4</a>Liemert, André, and Alwin Kienle. &quot;Light diffusion in N-layered turbid media: steady-state domain.&quot; Journal of biomedical optics 15.2 (2010): 025003.</li><li class="footnote" id="footnote-5"><a class="tag is-link" href="#citeref-5">5</a>Liemert, André, and Alwin Kienle. &quot;Light diffusion in N-layered turbid media: frequency and time domains.&quot; Journal of biomedical optics 15.2 (2010): 025002.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../DA_slab_semiinfgeom/">« Slab</a><a class="docs-footer-nextpage" href="../DA_DCS/">DCS »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Sunday 6 November 2022 21:45">Sunday 6 November 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
