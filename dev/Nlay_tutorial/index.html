<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>N-layer Cylinder Examples · LightPropagation.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">LightPropagation.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../install/">Installation</a></li><li><a class="tocitem" href="../getting-started/">Getting Started</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../inversefitting/">Inverse Fitting</a></li><li><a class="tocitem" href="../whensemiinf/">When is semi-infinite semi-infinite?</a></li><li class="is-active"><a class="tocitem" href>N-layer Cylinder Examples</a><ul class="internal"><li><a class="tocitem" href="#Layer-Example"><span>2-Layer Example</span></a></li><li><a class="tocitem" href="#Layer-Example-2"><span>5-Layer Example</span></a></li></ul></li></ul></li><li><span class="tocitem">Forward Models</span><ul><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">Diffusion Approximation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../DA_slab_semiinfgeom/">Slab</a></li><li><a class="tocitem" href="../Nlayer_cyl/">N-layer Cylinder</a></li><li><a class="tocitem" href="../DA_DCS/">DCS</a></li></ul></li></ul></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>N-layer Cylinder Examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>N-layer Cylinder Examples</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/heltonmc/LightPropagation.jl/blob/main/docs/src/Nlay_tutorial.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="N-layer-Cylinder-Examples"><a class="docs-heading-anchor" href="#N-layer-Cylinder-Examples">N-layer Cylinder Examples</a><a id="N-layer-Cylinder-Examples-1"></a><a class="docs-heading-anchor-permalink" href="#N-layer-Cylinder-Examples" title="Permalink"></a></h1><p>A major functionality of this package is the ability to perform forward modeling of the diffusion equation in arbitrarily layered media. This page will detail how to use the N-layer code including the functions <code>fluence_DA_Nlay_cylinder_CW</code>, <code>fluence_DA_Nlay_cylinder_TD</code>, and <code>fluence_DA_Nlay_cylinder_FD</code>. There are also other functions for N-layered cylinders such as <code>flux_DA_Nlay_cylinder_CW</code> that can be used in a similar manner.</p><h2 id="Layer-Example"><a class="docs-heading-anchor" href="#Layer-Example">2-Layer Example</a><a id="Layer-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Layer-Example" title="Permalink"></a></h2><p>The first example we will walk through is a simple 2-layered media. We will show how to simulate individual fluence values for the steady-state, time-domain, and frequency-domain as well as how to simulate a vector of fluence values at various times or source detector separations.</p><p>Below is a 2-layer media with example optical properties and layer thicknesses for a cylinder radius of a=20 cm. Note that for most scenarios, you will want to consider a sufficiently large radius to approximate a semi-infinite lateral geometry.</p><p><img src="../assets/2lay.png" alt="2lay"/></p><h3 id="Steady-state-example"><a class="docs-heading-anchor" href="#Steady-state-example">Steady-state example</a><a id="Steady-state-example-1"></a><a class="docs-heading-anchor-permalink" href="#Steady-state-example" title="Permalink"></a></h3><p>First we will go through the steady state example using the function <code>fluence_DA_Nlay_cylinder_CW</code>. This function has the following arguments including optional keyword arguments after the semicolon that default to a 2-layer medium:</p><pre><code class="language-julia hljs">fluence_DA_Nlay_cylinder_CW(ρ, μa, μsp; n_ext=1.0, n_med=(1.0, 1.0), l=(1.0, 5.0), a=10.0, z=0.0, MaxIter=10000, atol=eps(Float64))</code></pre><p>The units of ρ, l, a, z are all cm, whereas μa and μsp are in cm-1 and n<em>ext, n</em>med, and MaxIter are unitless. For this example we will be ignoring the keyword arguments for MaxIter and atol which determine the number of terms to include in the summation. For detailed information on what each of these arguments are, see the docs by typing <code>? fluence_DA_Nlay_cylinder_CW</code> in your julia window.</p><p>Below are the values you would put into this function to model the two-layered media in the figure above assuming ρ = 1 cm. Notice that μa, μsp, n_med, and l all must have the same number of arguments as you want layers in the model:</p><pre><code class="language-julia hljs">julia&gt; using LightPropagation
julia&gt; fluence_DA_Nlay_cylinder_CW(1.0, (0.20, 0.15), (15.0, 20.0); n_ext=1.0, n_med=(1.0, 1.0), l=(0.4, 0.8), a=20.0, z=0)
0.007359921451026246</code></pre><p>NOTE: It is recommended to put all arguments in decimal point form for type stability, i.e. μsp= 15.0 not 15.</p><p>We can see that our output is the fluence value at ρ=1 cm. If we wanted to simulate the fluence at multiple spatial locations to plot fluence against ρ, for example from 0 to 1.0 cm, we could simply create a range for the ρ variable as follows:</p><pre><code class="language-julia hljs">julia&gt; ρ = 0.1:0.1:1.0
julia&gt; cw_2lay = fluence_DA_Nlay_cylinder_CW(ρ, (0.20, 0.15), (15.0, 20.0); n_ext=1.0, n_med=(1.0, 1.0), l=(0.4, 0.8), a=20.0, z=0)</code></pre><p>And then subsequently we can plot the data like so:</p><pre><code class="language-julia hljs">julia&gt; using Plots	
julia&gt; plot(ρ, log10.(cw_2lay), xlabel=&quot;Source Detector Separation (cm)&quot;, ylabel=&quot;fluence (1/cm^2)&quot;, title=&quot;Steady-State Fluence&quot;,label=&quot;2-layer solution&quot;)</code></pre><p><img src="../assets/2lay_plot.png" alt="2lay_plot"/></p><h3 id="Time-domain-example"><a class="docs-heading-anchor" href="#Time-domain-example">Time-domain example</a><a id="Time-domain-example-1"></a><a class="docs-heading-anchor-permalink" href="#Time-domain-example" title="Permalink"></a></h3><p>We may also want to simulate light propagation through layered media in the time-domain. In order to do this we can utilize the function <code>fluence_DA_Nlay_cylinder_TD</code> which has slightly different arguments than those for the steady-state example:</p><pre><code class="language-julia hljs">fluence_DA_Nlay_cylinder_TD(t, ρ, μa, μsp; n_ext=1.0, n_med=(1.0, 1.0), l=(1.0, 5.0), a=10.0, z=0.0, MaxIter=10000, atol=eps(Float64), N, ILT)</code></pre><p>In this example we will focus on the required inputs, <code>t, ρ, μa, and μsp</code>, as well as the key word arguments <code>n_ext, n_med, l, a, z</code>, and also <code>N</code> which refers to the number of terms used in the integration of the Laplace transform. For more information on what each of these arguments are, see the docs by typing <code>? fluence_DA_Nlay_cylinder_TD</code> in your julia window.</p><p>Below are the values you would put into this function to model the 2-layered media  at a single time value (i.e. 1 ns) and ρ = 1.0 cm. Notice that μa, μsp, n_med, and l all must have the same number of arguments as you want layers in the model:</p><pre><code class="language-julia hljs">julia&gt; fluence_DA_Nlay_cylinder_TD(1.0, 1.0, (0.20, 0.15), (15.0, 20.0); n_ext=1.0, n_med=(1.0, 1.0), l=(0.4, 0.8), a=20.0, z=0)
2.2362727487107553e-5</code></pre><p>We can generate the fluence at multiple time values (i.e. 0.01 to 5.0 ns), enabling a simulation of fluence vs time that we can then visualize in a plot. The reason we are explicitly defining N in this example is because we have a large ratio of the selected end time to the start time, and otherwise we would see an oscillating solution. Below is the code and plot with the defined N term of 72:</p><pre><code class="language-julia hljs">julia&gt; t = 0.01:0.1:3.0
julia&gt; td_2lay = fluence_DA_Nlay_cylinder_TD(t, 1.0, (0.20, 0.15), (15.0, 20.0); n_ext=1.0, n_med=(1.0, 1.0), l=(0.4, 0.8), a=20.0, z=0, N=72)</code></pre><p><img src="../assets/2lay_plot_td.png" alt="2lay_plot_td"/></p><p>And here is what the plot would look like if we had not manually defined N=72 and the default was a smaller value:</p><p><img src="../assets/2lay_plot_oscillation.png" alt="2lay_plot_oscillation"/></p><h3 id="Frequency-domain-example"><a class="docs-heading-anchor" href="#Frequency-domain-example">Frequency-domain example</a><a id="Frequency-domain-example-1"></a><a class="docs-heading-anchor-permalink" href="#Frequency-domain-example" title="Permalink"></a></h3><p>Another modality of interest for modeling light propagation in layered media is in the frequency domain. The following example shows how you would model the same 2-layered media above for the frequency-domain using the function <code>fluence_DA_Nlay_cylinder_FD</code>, which has the following arguments:</p><pre><code class="language-julia hljs">fluence_DA_Nlay_cylinder_FD(ρ, μa, μsp; ω=1.0, n_ext=1.0, n_med=(1.0, 1.0), l=(1.0, 5.0), a=10.0, z=0.0, MaxIter=10000, atol=eps(Float64))</code></pre><p>For mor information on what each specific argument refers to type <code>? fluence_DA_Nlay_cylinder_FD</code> in your julia window.</p><p>For the purposes of this example, we will focus on the required inputs <code>ρ, μa, μsp</code>, as well as a few of the key-word arguments <code>n_ext, n_med, l, a</code>. Note that the function will still work if only the main arguments are defined and the keyword arguments will default to what is shown above.</p><p>Below is the code to model the 2-layer media shown above at ρ = 1.0 cm:</p><pre><code class="language-julia hljs">julia&gt; LightPropagation.fluence_DA_Nlay_cylinder_FD(1.0, (0.20, 0.15), (15.0, 20.0); n_ext=1.0, n_med=(1.0, 1.0), l=(0.4, 0.8), a=20.0, z=0)
0.007163897334701498 - 0.0014493145977509633im</code></pre><p>Like in the steady-state domain, we can simulate the fluence at multiple SDS in order to create a plot of fluence vs SDS:</p><pre><code class="language-julia hljs">julia&gt; ρ = 0.1:0.1:1.0
julia&gt; fd_2lay = LightPropagation.fluence_DA_Nlay_cylinder_FD(ρ, (0.20, 0.15), (15.0, 20.0); n_ext=1.0, n_med=(1.0, 1.0), l=(0.4, 0.8), a=20.0, z=0)</code></pre><pre><code class="language-julia hljs">plot(ρ, log10.(abs.(fd_2lay)), xlabel=&quot;Source detector separation (cm)&quot;, ylabel=&quot;fluence (1/cm^2)&quot;, title=&quot;Frequency-Domain Fluence&quot;,label=&quot;2-layer solution&quot;)</code></pre><p><img src="../assets/2lay_plot_fd.png" alt="2lay_plot_fd"/></p><h2 id="Layer-Example-2"><a class="docs-heading-anchor" href="#Layer-Example-2">5-Layer Example</a><a class="docs-heading-anchor-permalink" href="#Layer-Example-2" title="Permalink"></a></h2><p>In some cases, we may want a highly complicated layered model, for example, to model the natural layering we see in many biological tissues such as skin, fat and muscle layers or a complex 5-layer brain model. In this section we will show an example of how to use a 5-layer model in both the steady-state and time-domain. This example with arbitrary optical properties and layer thicknesses will serve as a basis for more specific simulations that are possible using our package.</p><p>Below is a figure of the model we will be recreating in this example:</p><p><img src="../assets/5lay.png" alt="5lay"/></p><h3 id="Steady-state-example-2"><a class="docs-heading-anchor" href="#Steady-state-example-2">Steady-state example</a><a class="docs-heading-anchor-permalink" href="#Steady-state-example-2" title="Permalink"></a></h3><p>Similarly to before, we can use the function <code>fluence_DA_Nlay_cylinder_CW</code> to perform a steady-state simulation of fluence at a single source detector separation for the given model:</p><pre><code class="language-julia hljs">julia&gt; fluence_DA_Nlay_cylinder_CW(1.0, (0.20, 0.10,0.15,0.35,0.25), (20.0, 15.0, 10.0, 25.0, 12.0); n_ext=1.0, n_med=(1.0, 1.0, 1.0, 1.0, 1.0), l=(0.4, 0.8, 0.3, 0.5, 8.0), a=20.0, z=0)
0.004532033682694147</code></pre><p>Or we can simulate at multiple source detector separations and generate a plot:</p><pre><code class="language-julia hljs">julia&gt; ρ = 0.1:0.1:1.0
julia&gt; cw_5lay = fluence_DA_Nlay_cylinder_CW(ρ, (0.20, 0.10,0.15,0.35,0.25), (20.0, 15.0, 10.0, 25.0, 12.0); n_ext=1.0, n_med=(1.0, 1.0, 1.0, 1.0, 1.0), l=(0.4, 0.8, 0.3, 0.5, 8.0), a=20.0, z=0)</code></pre><pre><code class="language-julia hljs">julia&gt; plot(ρ, log10.(cw_5lay), xlabel=&quot;Source Detector Separation (cm)&quot;, ylabel=&quot;fluence (1/cm^2)&quot;, title=&quot;Steady-State Fluence&quot;,label=&quot;5-layer solution&quot;)</code></pre><p><img src="../assets/5lay_plot_cw.png" alt="5lay_plot_cw"/></p><h3 id="Time-domain-example-2"><a class="docs-heading-anchor" href="#Time-domain-example-2">Time-domain example</a><a class="docs-heading-anchor-permalink" href="#Time-domain-example-2" title="Permalink"></a></h3><p>Once again, we can repeat the process of simulating light propagation in the 5-layered model in the time-domain using the function <code>fluence_DA_Nlay_cylinder_TD</code>. </p><p>Below are the values you would use to model the 5-layered media above for a single time value (i.e. 1 ns) at ρ = 1.0 cm. Notice that μa, μsp, n_med, and l all have five arguments for the properties of each of the five layers:</p><pre><code class="language-julia hljs">julia&gt; fluence_DA_Nlay_cylinder_TD(1.0, 1.0, (0.20, 0.10,0.15,0.35,0.25), (20.0, 15.0, 10.0, 25.0, 12.0); n_ext=1.0, n_med=(1.0, 1.0, 1.0, 1.0, 1.0), l=(0.4, 0.8, 0.3, 0.5, 8.0), a=20.0, z=0)
0.00010011858037953052</code></pre><p>We can also simulate at multiple times in order to generate a plot of the fluence vs time:</p><pre><code class="language-julia hljs">julia&gt; t = 0.01:0.1:3.0
julia&gt; td_5lay = fluence_DA_Nlay_cylinder_TD(t, 1.0, (0.20, 0.15), (15.0, 20.0); n_ext=1.0, n_med=(1.0, 1.0), l=(0.4, 0.8), a=20.0, z=0, N=72)</code></pre><p><img src="../assets/5lay_plot_td.png" alt="5lay_plot_td"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../whensemiinf/">« When is semi-infinite semi-infinite?</a><a class="docs-footer-nextpage" href="../DA_slab_semiinfgeom/">Slab »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Saturday 5 November 2022 16:46">Saturday 5 November 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
